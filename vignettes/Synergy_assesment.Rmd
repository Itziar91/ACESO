---
title: "Synergy assesment"
author: "Itziar Irurzun Arana"
date: "`r Sys.Date()`"
output:  
  prettydoc::html_pretty:
    theme: cayman 
    highlight: github
vignette: >
  %\VignetteIndexEntry{Synergy assesment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warnings= FALSE
)
```

Load libraries:
```{r}
library(ACESO)
library(ggplot2)
```

## Data
In the current evaluation, cell viability data resulting from the exposure of BT-20 triple-negative breast cancer cell line  to the combination of different concentrations of two small molecule kinase inhibitors (dactolisib and trametinib) is analyzed. The data was obtained from the HMS LINCS database (\url{https://lincs.hms.harvard.edu/}). The objective of this vignette is to analyze the possible synergism that arises from the combination of the drugs. 

```{r}
data(Dactolisib_Trametinib_rates)
head(GD)

DrugA=as.character(GD$Drug.Name[1])
DrugB=as.character(GD$Drug2.Name[1])
print(c(DrugA,DrugB))
```
Use **responseMap** function to plot the surface of the birth rate values versus both drug concentrations:
```{r}
rmap <- responseMap(Birth_rate~CONC+CONC2,GD,logscale=T,interpolate=FALSE)
DifferenceSurface.plot(rmap,zcenter=max(GD$Birth_rate)/2,
                       xl=paste0("[",DrugA,"] (µM)"),
                       yl=paste0("[",DrugB,"] (µM)"),
                       zl="Birth rate of \n sensitive cells, b0 (1/h)",
                       mid="yellow",low="hotpink1",high="darkturquoise")

```

Use **responseMap** again and **plot.ResponseSurface** to make a contour plot of the data. For this plot a interpolation of the data is needed (see logscale=T in the **responseMap** function):
```{r}
rmap <- responseMap(Birth_rate~CONC+CONC2,GD,logscale=T)

ResponseSurface.plot(rmap,xl=paste0("[",DrugA,"] (µM)"),
                     yl=paste0("[",DrugB,"] (µM)"),
                     zl="Birth rate of \n sensitive cells, b0 (1/h)",
                     palette=c("hotpink1","yellow","darkturquoise"))

```
## Loewe additivity
```{r}
GD=Loewe(data=GD,resp = 'Birth_rate')
```
A new column called 'loewe_addivity' is created.
Now we plot the response surface of the data using the newly created column to compare it with the previous response surface for the birth rates of sensitive cell population.
```{r}
rmap_loewe <- responseMap(loewe_additivity~CONC+CONC2,GD,logscale=T)

ResponseSurface.plot(rmap_loewe,xl=paste0("[",DrugA,"] (µM)"),
                     yl=paste0("[",DrugB,"] (µM)"),
                     zl="Birth rate of \n sensitive cells, b0 (1/h)",
                     palette=c("hotpink1","yellow","darkturquoise"))
```                     

For a proper comparison of the surfaces, we calculate the difference between them and plot the results in a colored pairwise matrix:

```{r}
GD$diffLoewe=(GD$loewe_additivity-GD$Birth_rate)

GD$CONC_String<-as.character(GD$CONC)
GD$CONC2_String<-as.character(GD$CONC2)
 GD$CONC2_String <- factor(GD$CONC2_String, levels = as.character(sort(as.numeric(unique(GD$CONC2_String)))))

ggplot(data=GD, aes(x = CONC_String, y = CONC2_String)) + 
  geom_raster(aes(fill=diffLoewe)) + 
  scale_fill_gradient2(midpoint=0,mid = "#333333",low="#018571",high="#FFCC00","Loewe score")+
  labs(x="Dactolisib concentration (µM)", y="Trametinib concentration (µM)") +
  theme(text=element_text(size=9),
                      axis.text=element_text(size=6.5,colour="black"),
                      strip.text=element_text(size=7.5),
                      axis.title=element_text(colour="black"))

```

## Highest Single Agent (HSA)
Repeat the process using the HSA model:
```{r}
GD=HSA(GD,resp = 'Birth_rate')

GD$diffHSA=(GD$HSA_response-GD$Birth_rate)

GD$CONC_String<-as.character(GD$CONC)
GD$CONC2_String<-as.character(GD$CONC2)
 GD$CONC2_String <- factor(GD$CONC2_String, levels = as.character(sort(as.numeric(unique(GD$CONC2_String)))))

ggplot(data=GD, aes(x = CONC_String, y = CONC2_String)) + 
  geom_raster(aes(fill=diffHSA)) + 
  scale_fill_gradient2(midpoint=0,mid = "#333333",low="#018571",high="#FFCC00","HSA score")+
  labs(x="Dactolisib concentration (µM)", y="Trametinib concentration (µM)") +
  theme(text=element_text(size=9),
                      axis.text=element_text(size=6.5,colour="black"),
                      strip.text=element_text(size=7.5),
                      axis.title=element_text(colour="black"))
```





